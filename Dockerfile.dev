# FROM node:20-alpine

# WORKDIR /app

# # Install pnpm
# RUN npm install -g pnpm

# # Copy package files and install dependencies
# COPY package.json pnpm-lock.yaml ./
# RUN pnpm install --frozen-lockfile

# # Copy prisma schema
# COPY prisma ./prisma

# # Copy the rest of the application
# COPY . .

# # Development settings
# ENV NODE_ENV=development
# ENV PORT=3000
# EXPOSE 3000

# # Generate Prisma client and start dev server
# CMD ["sh", "-c", "npx prisma generate && npx prisma db push && pnpm run dev"]



FROM node:20-alpine
WORKDIR /app

RUN npm install -g pnpm

COPY package.json pnpm-lock.yaml ./
RUN --mount=type=cache,id=pnpm,target=/root/.local/share/pnpm/store \
    pnpm install --frozen-lockfile

COPY prisma ./prisma
RUN pnpm prisma generate

COPY . .

ENV NODE_ENV=development
ENV PORT=3000
EXPOSE 3000

CMD ["sh", "-c", "pnpm prisma db push && pnpm run dev"]